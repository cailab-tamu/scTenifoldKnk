setwd("~/scTenifoldKNK/inst/manuscript/NKX2-1/Code")
CT <- read.csv('../Data/PanglaoDB_markers_27_Mar_2020.tsv', header = TRUE, sep = '\t', stringsAsFactors = FALSE)
namesCT <- unique(CT$cell.type)
CT <- lapply(namesCT, function(X){
CT$official.gene.symbol[CT$cell.type %in% X]
})
names(CT) <- namesCT
load('../Results/GSM3716703.RData')
dGenes <- GSM3716703$diffRegulation$gene[GSM3716703$diffRegulation$p.adj < 0.01]
dGenes
toupper(dGenes) %in% CT$`Pulmonary alveolar type I cells`
sum(toupper(dGenes) %in% CT$`Pulmonary alveolar type I cells`)
sum(toupper(dGenes) %in% CT$`Pulmonary alveolar type II cells`)
dGenes[(toupper(dGenes) %in% CT$`Pulmonary alveolar type II cells`)]
writeLines(dGenes[(toupper(dGenes) %in% CT$`Pulmonary alveolar type II cells`)], sep = ', ')
writeLines(dGenes[(toupper(dGenes) %in% CT$`Pulmonary alveolar type I cells`)], sep = ', ')
sum(toupper(dGenes) %in% CT$`Pulmonary alveolar type II cells`)
mean(toupper(dGenes) %in% CT$`Pulmonary alveolar type II cells`)
CT$`Pulmonary alveolar type I cells`
CT$`Pulmonary alveolar type isIncomplete() cells`
CT$`Pulmonary alveolar type II cells`
writeLines(sort(dGenes[(toupper(dGenes) %in% CT$`Pulmonary alveolar type I cells`)]), sep = ', ')
setwd("~/scTenifoldKNK/inst/manuscript/TREM2/Code")
# setwd('/data/dcosorioh/manuscript/')
#
# library(Matrix)
# scTenifoldKnk <- function(countMatrix, gKO = NULL){
#   set.seed(1)
#   WT <- scTenifoldNet::makeNetworks(countMatrix, q = 0.9)
#   set.seed(1)
#   WT <- scTenifoldNet::tensorDecomposition(WT)
#   WT <- as.matrix(WT$X)
#   #KO <- rCUR::CUR(WT, sv = RSpectra::svds(WT, 5))
#   #C <- KO@C
#   #C[gKO,] <- 0
#   #KO <- C %*% KO@U %*% KO@R
#   KO <- WT
#   KO[gKO,] <- 0
#   set.seed(1)
#   MA <- scTenifoldNet::manifoldAlignment(WT, KO)
#   set.seed(1)
#   DR <- scTenifoldNet::dRegulation(MA)
#   outputList <- list()
#   outputList$WT <- WT
#   outputList$KO <- KO
#   outputList$diffRegulation <- DR
#   return(outputList)
# }
# source('https://raw.githubusercontent.com/dosorio/utilities/master/singleCell/scQC.R')
#
# WT <- readMM('TREM2/Data/matrix_WT.mtx')
# rownames(WT) <- readLines('TREM2/Data/geneNames_WT.txt')
# colnames(WT) <- readLines('TREM2/Data/barcodes_WT.txt')
# WT <- scQC(WT)
# WT <- WT[rowMeans(WT != 0) > 0.05,]
# WT <- WT[!grepl('^Rp[[:digit:]]+|^Rpl|^Rps|^Mt-', rownames(WT), ignore.case = TRUE),]
# WT <- scTenifoldKnk(WT, gKO = 'Trem2')
# save(WT, file = 'TREM2_GSE130626.RData')
library(fgsea)
library(ggplot2)
library(enrichR)
library(igraph)
source('https://raw.githubusercontent.com/dosorio/utilities/master/singleCell/plotDR.R')
source('https://raw.githubusercontent.com/dosorio/utilities/master/singleCell/plotKO.R')
source('https://raw.githubusercontent.com/dosorio/utilities/master/idConvert/hsa2mmu_SYMBOL.R')
load('../Results/GSE130626.RData')
dGenes <- GSE130626$diffRegulation$gene[GSE130626$diffRegulation$p.adj < 0.05]
DR <- GSE130626$diffRegulation
View(DR)
dGenes
writeLines(dGenes)
WT <- readMM('TREM2/Data/matrix_WT.mtx')
library(Matrix)
WT <- readMM('TREM2/Data/matrix_WT.mtx')
WT <- readMM('../Data/matrix_WT.mtx')
dim(WT)
View(DR)
